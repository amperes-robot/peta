%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[11pt, oneside]{article} % The default font size and one-sided printing (no margin offsets)
\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}
\graphicspath{{Figures/}}
\usepackage[square, numbers, comma, sort&compress]{natbib} % Use the natbib reference package - read up on this to edit the reference style; if you want text (e.g. Smith et al., 2012) for the in-text references (instead of numbers), remove 'numbers' 
\usepackage[parfill]{parskip}
\usepackage[margin=1in]{geometry}
\usepackage{tabularx}
\usepackage{array}
\usepackage{hyperref}
\hypersetup{
	colorlinks,
	citecolor=blue,
	filecolor=blue,
	linkcolor=blue,
	urlcolor=blue
}
\newcolumntype{P}[1]{>{\centering\arraybackslash}p{#1}}
\renewcommand{\arraystretch}{1.5}

\begin{document}


% Define the page headers using the FancyHdr package and set up for one-sided printing


\newcommand{\HRule}{\rule{\linewidth}{0.5mm}} % New command to make the lines in the title page


%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\begin{titlepage}
\begin{center}

\textsc{\LARGE ENPH 253 Design Proposal}\\[1.5cm]

\HRule \\[0.4cm] % Horizontal line

{\huge \bfseries "ROBOT NAME HERE"}\\[0.4cm]

\HRule \\[1.5cm] % Horizontal line
 
\begin{minipage}[t]{0.4\textwidth}
\begin{flushleft} \large
\emph{Team Members:}\\
{Scott Fjordbotten \newline Anne Lim \newline Johnson Liu \newline Kevin Zhang} % Author names
\end{flushleft}
\end{minipage}
\begin{minipage}[t]{0.4\textwidth}
\begin{flushright} \large
\emph{Instructors:} \\
{Dr. Andre Marziali \\ Dr. Jon Nakane \\ Mr. Bernhard Zender} % Instructors names
\end{flushright}
\end{minipage}\\[3cm]
 
 
{\large June 2015}\\[4cm]
%\includegraphics{Logo} % University/department logo - uncomment to place it
 
\vfill
\end{center}

\end{titlepage}



%----------------------------------------------------------------------------------------
%	Executive Summary
%----------------------------------------------------------------------------------------
\section*{Executive Summary}
This document contains the proposed specifications of a robot designed to complete the 2015 ENPH 253 Pet-Rescue Bots challenge. The robot should be able to navigate through an 8' by 8' foot ramp by following a tape path, and collect "Pets", which are Beanie toys of height 6" with magnets attached to them. The robot will then transport itself and the toys to a "safe area" via a zip line of height 19", which goes from the end of the path to the start.

The robot must be able to go through a doorway which is 14" wide and 18" tall. As for the Pets, some will be placed along and beside the path, and others will be located in containers. All will be unattached from the playing surface.

Our robot will be controlled by a TINAH Board using a ATMega128 processor, and QRD114 sensors will be used to detect the tape path.

\newpage

%----------------------------------------------------------------------------------------
%	LIST OF CONTENTS/FIGURES/TABLES PAGES
%----------------------------------------------------------------------------------------

\tableofcontents % Write out the Table of Contents
\listoffigures % Write out the List of Figures
\listoftables % Write out the List of Tables

%----------------------------------------------------------------------------------------

\newpage
%	Document Content
%---------------------------------------------------------------------------------------

%--------------------------------------------
%PREFACE
\section{Preface}

%--------------------------------------------
%Overview of Basic Strategy
\section{Overview of Basic Strategy}

Our robot will contain a meshed in area at the front to carry the pets. Pets will be picked up by a plastic arm with a steel bracket on the end which will move along a circular path in the plane parallel to the front of the robot to magnetically attach and collect the pets. Below the steel bracket will be attached a hinged aluminium plate that will be sandwiched between the steel plate and any attached magnet, triggering a micro-switch when a magnet is attached. A rod fixed to the chassis will be located at the end of the arm's path such that the load will be sheared off the metallic plate in order to land in the meshed area.

The robot will start following the tape in the starting location and follow it using a single QRD sensor connected to an analog input on the TINAH board and a proportional-integral-derivative controller algorithm. Upon detecting tape markers perpendicular to the main tape path using a side QRD connected to a LM311 comparator and a digital input, the retrieval arm will then be lowered until the attachment signal is received from the micro-switch. At this point, the arm will retract until the load is sheared off using the fixed rod, which can be detected by the falling signal from the micro-switch. The pet located in the middle of the path will magnetically attach to a steel bracket at the front of the robot and will remain attached to this bracket for the duration of the heat. The pet located on the elevated rafters will be located using the IR beacon and the rotary encoders on the wheels to determine the distance travelled since the end of the tape.

After collecting the elevated pet, the robot will continue to follow the IR beacon until the intensity from the beacon reaches a certain threshold, to be determined empirically. Based on encoder data, the robot will pivot 90 degrees to position the retrieval arm along the edge of the box. The retrieval arm will be used to push the Styrofoam rubble aside and retrieve the last pet.

At this point, the robot should be positioned below and facing away from the zipline. An arm located on the left side of the robot opposite the pet retrieval arm and containing a magnetically attached zipline pulley will swing in the plane parallel to the side of the robot to attach the pulley to the zipline. A winch in the centre of the robot and attached to the bottom side of the pulley will simultaneously detach the pulley from the zipline arm and lift the robot off the ground. Once off the ground, the robot will roll down the zipline to the Safe Area by virtue of gravity.

%--------------------------------------------
%Mechanical Design
\section{Mechanical Design}

Our robot will consist of four main mechanical sub-assemblies: The Chassis, The Retrieval Arm, and The Zipline Apparatus. These assemblies have been designed such that they are independent modules that can be built and tested at a basic level in parallel. This design section has been broken into sections to show each element individually before being combined into the complete version of the robot.

	\subsection{The Chassis}

	The Chassis is the base for the robot. The Chassis consists of the Chassis Plate and two supports for the rear drive motors and axles. The Chassis Plate includes two vertical sections at the rear that support the components of the Board Storage Space. These sections will be discussed in more detail in the 'Board Storage Space' subsection. Circular holes have been integrated in the front portion of the chassis plate to allow for wire routing to the tape following and tape detection QRD1114 reflectance sensors. The Chassis Plate and motor supports will be manufactured from 20 gauge aluminium to limit the overall weight of the robot. Additional brackets may be fabricated to reinforce the edge flange joints if necessary. The complete Chassis and Board Storage module is shown in \autoref{fig:chassisAssy}.

	\begin{figure}[h]
		\centering
		\includegraphics[scale=0.5]{"Figures/Chassis Body".jpg}
		\caption[Chassis]{The Chassis}
		\label{fig:1}
	\end{figure}

		\subsubsection{Pet 4 Pickup Arm}
		The fourth pet (in the middle of the path) will be picked up statically. To accomplish this there will be a steel bracket mounted to the front of the chassis via a acrylic arm (See \autoref{fig:front arm}). The steel bracket will be at the height of the pets head and reinforced with magnets to ensure the pet does not fall off in the IR and zipline phases of the course.
	
		\subsubsection{The Sled}
		Rather than building structures to support wheels at the front of the robot, we will construct a sled and attach it to the front of the chassis via two axle mounted brackets (See \autoref{fig:front sled}). The sled will be free to pivot about the mounting axles to minimize the chance of the sled catching on something and forcing the robot off the desired trajectory. The sled will also have a support (not shown) and hole for the tape following QRD. Both the sled and its mounting brackets will be constructed from 20 gauge aluminum.
		
		\subsubsection{Board Storage Space}

		The Board Storage Space is integrated into the rear of the chassis. The vertical sections of the chassis contain slots and tabs to support the three shelves in the Board Storage Space (See \autoref{fig:3}). The shelves will be 3.4" deep and 7.8" long and will have a flange at the front to prevent boards from sliding off the shelves. The two bottom shelves will house circuit boards; once the bottom two shelves have been loaded with boards, the back plate will be screwed on to secure the shelves. The top shelf will support the TINAH in conjunction with the back plate. Two mounting features for the TINAH are on the front of the top shelf while the remaining two are on the top of the back plate.
			
		\begin{figure}[!ht]
			\centering
			\begin{minipage}[t]{.5\textwidth}
				\centering
				\includegraphics[scale=0.5]{"Figures/Board Storage Space".jpg}
				\caption[Board Storage Space]{Board Storage Space}
				\label{fig:2}
			\end{minipage}%
			\begin{minipage}[t]{.5\textwidth}
				\centering
				\includegraphics[scale=0.5]{"Figures/chassis back features".jpg}
				\caption[Board Storage Support Features]{Board Storage Support Features}
				\label{fig:3}
			\end{minipage}
		\end{figure}
		
		\begin{figure}[!ht]
			\begin{minipage}[t]{.5\textwidth}
				\centering
				\includegraphics[scale=0.75]{"Figures/frontSled".jpg}
				\caption[The Sled]{The font sled}
				\label{fig:front sled}
			\end{minipage}%
			\begin{minipage}[t]{.75\textwidth}
				\centering
				\includegraphics[scale=1]{"Figures/frontArm".jpg}
				\caption[Front Arm]{The front arm for statically \\ collecting pet 4}
				\label{fig:front arm}
			\end{minipage}
		\end{figure}
		
		\begin{figure}[!ht]
			\centering
			\includegraphics[scale=0.5]{"Figures/chassisAssy".jpg}
			\caption[Complete Chassis and Board Storage Module]{Complete Chassis and Board Storage Module}
			\label{fig:chassisAssy}
		\end{figure}
		
	\subsection{The Retrieval Arm}
	The retrieval arm consists of two main section: the supporting body (\autoref{fig:armBody}) and the arm end (\autoref{fig:armEnd}). The supporting body is constructed out of 20 gauge aluminum. It houses the arm sections, gears and pet knock off tool (\autoref{fig:knockOffTool})and will attach to the chassis via pop rivet. There will be two arm sections, one strait and one that will double as the large driving gear. Both arms will be cut out of acrylic(\autoref{fig:arm}). The gear ratio between the driving DC motor and the arm gear will be 5:1 as determined in \autoref{AppendixA}. The knock of tool will be made of 3.2mm diameter round steel and positioned so that pets will be knocked off the arm above the chassis. The length and center of rotation of the arm were chosen such that the arm is the same distance from the chassis center(eight inches) when the pick up surface is at both six and twelve inches from the playing surface so that both arms can be used to pick up the pets placed on the surface and the pet that is elevated.
	
		\subsubsection{Retrieval Arm End}
		The arm end will consist of a body made of acrylic, L-brackets made of steel to magnetically attach to pets, and aluminum sheets that will be pushed into micro-switches when a pet is picked up(\autoref{fig:armEnd}). There will be two such L-bracket assemblies. The smaller assembly, facing the front of the robot, will be used to pick up pets 1-4 and 5. This arm will align with the knock off tool to deposit pets in the chassis. The larger assembly, facing the rear of the robot, is at the bottom of the body and will be used to collect pet 6 from the box of foam. This assembly will be reinforced with magnets and the 6th pet will remain on the bracket for the remainder of the course.
		
	\begin{figure}[h]
		\centering
		\begin{subfigure}[b]{0.4\textwidth}
			\centering
			\includegraphics[scale=0.5]{"Figures/armBodyFront".jpg}
			\caption{Front View}
		\end{subfigure}
		~
		\begin{subfigure}[b]{0.5\textwidth}
			\centering
			\includegraphics[scale=0.5]{"Figures/armBodyRear".jpg}
			\caption{Rear View}
		\end{subfigure}
		\caption[Retrieval Arm Body]{Retrieval Arm Body}
		\label{fig:armBody}
	\end{figure}
		
	\begin{figure}[h]
		\centering
		\begin{minipage}[t]{.5\textwidth}
			\centering
			\includegraphics[scale = 0.4]{"Figures/armEnd".jpg}
			\caption[Retrieval Arm End]{Retrieval Arm End}
			\label{fig:armEnd}
		\end{minipage}%
		\begin{minipage}[t]{.5\textwidth}
			\centering
			\includegraphics[scale=0.4]{"Figures/armArms".jpg}
			\caption[Retrieval Arm Arms]{Retrieval Arm Arms}
			\label{fig:arm}
		\end{minipage}
	\end{figure}
	
	\begin{figure}[!h]
		\centering
		\includegraphics[scale=0.4]{"Figures/knockOffTool".jpg}
		\caption[Knock Off Tool]{Knock Off Tool}
		\label{fig:knockOffTool}
	\end{figure}
	
	\subsection{The Zipline Apparatus}
		\subsubsection{Zipline Delivery System}
	
		\subsubsection{The Zipline Pulley}
	
		\subsubsection{The Winch System}

%--------------------------------------------
%Drive and Actuator Systems
\section{Drive and Actuator Systems}


TEST
	\subsection{Drive System}
	
	\subsection{Retrieval Arm Actuation}
	
	\subsection{Zipline Apparatus Actuation}
	
		\subsubsection{Zipline Delivery System Actuation}
		
		\subsubsection{Zipline Winch Actuation}


%--------------------------------------------
%Sensor System

\section{Sensor System}
	
	\subsection{Tape Following}
	
	TEST
	
	\subsection{IR Detection}
	
	\subsection{Wheel Encoders}
	
	\subsection{Pet Pick-up Detection}
	
%--------------------------------------------
%Electrical Design

\section{Electrical Design}

	\subsection{Driving and Arm Actuation}
	
	There will be two motors for driving, each powering one wheel using differential steering. Each motor will be connected to a motor output on TINAH via an external H-bridge with a comparator attached. Similarly, an H-bridge is also used for actuating the arm for picking up pets and another for actuating the zipline delivery apparatus. The circuit schematic is in \hyperref[sch:A]{Schematic A} of \hyperref[appendixB]{Appendix B}.
	
	\subsection{Detecting Pets and Following Tape}
	
	There will be a QRD1114 photo-transistor to be used for tape following by PID algorithm. It will be connected to an analog input pin on TINAH. Another QRD1114 will be placed on the side of the robot and connected to a digital input on TINAH with a comparator for detecting tapes leading to pets. The circuit for these 2 photo-transistors is in \hyperref[sch:B]{Schematic B} of \hyperref[appendixB]{Appendix B}. 
	
	\subsection{IR Beacon Detection}
	
	\hyperref[sch:C]{Schematic C} of \hyperref[appendixB]{Appendix B} section shows the circuit for the 2 IR detectors used for detecting the IR beacons during the competition. The type of IR detector we'll be using is QSD124. 
	
	\subsection{Winch Actuation}
	
	For actuating the winch which will move the roller of the zipline onto the pipe, \hyperref[sch:D]{Schematic D} of \hyperref[appendixB]{Appendix B} will be used. It consists mainly of an N-type MOSFET switch for driving the motor for winch in one direction. 
	
	\subsection{Pet Pick-Up Detection}
	
	The micro-switch in \hyperref[sch:E]{Schematic D} of \hyperref[appendixB]{Appendix B} indicates how to detect if a pet has been picked up and placed into the container. If the value read is high, it means no pet is attached to the retrieval arm. If the value read is low, then it means there is a pet attached to the retrieval arm. 
	
	
	\begin{table}[h]
		\caption{Table of TINAH Pin Connections}
		\centering
		\begin{tabular}[t]{|P{0.5in}|p{2in}|}
			\hline
			\textbf{Digital Pin} & \textbf{Input/Output} \\
			\hline
			0 & Pet Marker QRD \\
			\hline
			1 & Pickup Microswitch Lower \\
			\hline
			2 & Pickup Microswitch Upper \\
			\hline
			3 & Winch Enable \\
			\hline
			4 & Wheel Encoder Left \\
			\hline
			5 & Wheel Encoder Right\\
			\hline
		\end{tabular}
		\quad
		\begin{tabular}[t]{|P{0.5in}|p{2in}|}
			\hline
			\textbf{Analog Pin} & \textbf{Input/Output} \\
			\hline
			0 & IR Sensor Left \\
			\hline
			1 & IR Sensor Right \\
			\hline
			2 & Tape Follower QRD \\
			\hline
			\multicolumn{2}{c}{ } \\
			\hline
			\textbf{Motor Pin} & \textbf{Output}\\
			\hline
			0 & Drive Motor Left \\
			\hline
			1 & Drive Motor Right \\
			\hline
			2 & Retrieval Arm Motor \\
			\hline
			3 & Zipline Arm Motor \\
			\hline
		\end{tabular}
		\label{table:TINAHpins}
	\end{table}
	
	\begin{table}[h]
		\caption{Table of PCB Information}
		\centering
		\begin{tabular}[t]{ | P{0.7in} | p{1.5in} | P{0.7in} | p{1.2in} | P{1in} | }
			\hline
			\textbf{PCB Number} & \textbf{Purpose} & \textbf{Size (mm)} & \textbf{Components Connected} & \textbf{Rails Needed} \\
			\hline
			1 & H-bridges: Drive Motors Left and Right, Retrieval Arm Motor, Zipline Arm Motor & 180 x 70 & TINAH, 4 DC motors & GND, 5V, 15V\\
			\hline
			2 & IR detection circuitry & X x X & TINAH, 2 photodiodes & GND, 5V, $\pm$ 9V\\
			\hline
			3 & ??? & X x X & ??? & ???\\
			\hline
		\end{tabular}
		\label{table:PCBInfo}
	\end{table}
	
%--------------------------------------------
%Softwate and Code Algorithms

\section{Software and Code Algorithms}	
The software will operate statefully, with one main control loop that handles the primary strategy and execution. At the same time, a 10kHz timer interrupt will run in parallel which will handle the time-sensitive operation of polling input pins.
The main control loop will call upon a variety of different modes that describe the current operation at any given point in the program's execution. A summary of the different modes and their transitions is described in the \autoref{fig:4} below.
\begin{figure}[h]
	\centering
	\includegraphics[scale=0.5]{"Figures/Software Modes".jpg}
	\caption[Software Modes]{Software Modes}
	\label{fig:4}
\end{figure}

A more detailed description of the modes is shown below in \autoref{table:Software Modes}.
On the 10kHz timer interrupt will be attached a procedure that handles pin inputs. Because the default analogRead function blocks until the ADC conversion finishes (approximately a 1000-cycle process), carrying out the conversion in parallel can significantly decrease loop latency. Additionally, polling digital pin inputs on the timer interrupt can provide a better guarantee that changes in digital inputs will not be missed because of latency in the main loop.

\begin{table}
	\caption{Table of Software Modes}
	\centering
	\begin{tabular}{ | c | p{5in} | }
	\hline
	Mode & Description \\ \hline \hline
	Main Menu & This is the mode automatically entered when the board boots. The knobs are used to cycle between menu options. Additionally, any mode can be cancelled to return to the Main Menu. \\ \hline
	Options Menu & Allows runtime parameters to be modified using the second knob. \\ \hline
	Segment Select & Starts the selected mode from a list containing modes during program execution. \\ \hline
	Course Begin & Transitions to the Follow/Retrieval mode. \\ \hline
	Follow/Retrieval & Follows the tape and picks up the first three animals. Upon reaching the end of the tape (once all horizontal marks have been detected), switches to the Beacon Homing mode. \\ \hline
	Beacon Homing & Using the two forward IR sensors, navigates towards the IR beacon. Picks up the elevated pet on the rafters by measuring distance from the end of the tape. Switches to Rubble Excavation upon IR sensor intensity reaching a threshold to be determined empirically. \\ \hline
	Rubble Excavation & Turns 90 degrees and brushes off the top layer of foam using the arm. Attempts to find and retrieve the pet buried in the foam, and upon retrieving it (or on approaching the 2 minute time limit), switches to Zipline/Return. \\ \hline
	Zipline/Return &
	Uses the side IR sensor to align the robot with the beacon, raises the zipline arm, and cranks the winch up to return to the Safe Area. Returns to Main Menu afterwards.
	\\ \hline
	\end{tabular}
	\label{table:Software Modes}
\end{table}

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.5]{"Figures/Software State Diag".jpg}
	\caption[Software State Diagram]{Software State Diagram}
	\label{fig:SoftStates}
\end{figure}

	\subsection{Error Handling}
		\subsubsection{Unable to Retrieve Pet in Loft}
		We will make several attempts at this, adjusting the position of the robot each time. If after a certain number attempts we have not retrieved the pet, we will move on to the next stage.
		\subsubsection{Lost Tape}
		We will adjust proportional, differential, and integral constants to minimize this risk. Additionally, using wheel encoders allows us to have an additional input, which we can use to correct position if the tape is lost.

%--------------------------------------------
%Risk Assessment and Contingency Planning

\section{Risk Assessment and Contingency Planning}

See \autoref{table:Risk Assessment} below:
\begin{table}
	\caption{Risk Assessment}
	\centering
	\label{table:Risk Assessment}
\end{table}

%--------------------------------------------
%Task Schedule and Responsibilities

\section{Task Schedule and Responsibilities}

\begin{table}
	\caption{Task Schedule}
	\centering
	\label{table:Task Schedule}
\end{table}

\input{"appendix.tex"}

\end{document}  
